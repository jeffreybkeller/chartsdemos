<html>
<head>
  <style>
  .axis {
    fill: #444444;
  }
  .selection_line
          {
              stroke: rgba(0, 0, 0, 0.6);
              shape-rendering: crispEdges;
          }  
  </style>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.2.2/d3.js"></script>
  <script src="https://code.jquery.com/jquery-3.1.0.js" 
    integrity="sha256-slogkvB1K3VOkzAI8QITxV3VzpOnkeNVsKvtkYLMjfk="
    crossorigin="anonymous">
  </script>
  <script type="text/javascript">
    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(drawWeightChart);
    google.charts.setOnLoadCallback(drawBloodPressureChart);
    
    function customizations(chartId) {
      var maxY = 0;
      var minX = 999999;

      $("#" + chartId + " g[clip-path] g rect").each(function() {

        // Calculate the maximum y value for horizontal lines, which
        // will be our horizontal axis
        y = parseInt($(this).attr("y"));
        height = parseInt($(this).attr("height"));
        if (height === 1 && y > maxY) {
          maxY = y;
        }
      
        
      });
      
      // Color the axis. We will change this to give a class, maybe, so 
      // we can control it via CSS
      $("#" + chartId + " g[clip-path] g rect[height='1'][y='" + maxY + "']").addClass("axis")

    }
    
    function drawWeightChart() { 
      var weightDataTable = new google.visualization.DataTable();
      weightDataTable.addColumn({ type: 'date', id: 'Date' });
      weightDataTable.addColumn({ type: 'number', id: 'Weight', label: "Weight" });
      weightDataTable.addRows([
        [new Date('07/04/2016'),  180],
        [new Date('08/08/2016'),  190],
        [new Date('10/22/2016'),  191],
        [new Date('11/25/2016'),  210]
      ]);
      drawChart("weight", weightDataTable);
      customizations("weight");
    }
    
    function drawBloodPressureChart() { 
      
      var dataTable = new google.visualization.DataTable();
      var dataTable2 = new google.visualization.DataTable();

      dataTable.addColumn({ type: 'date', id: 'Date' });
      dataTable2.addColumn({ type: 'date', id: 'Date' });

      dataTable.addColumn({ type: 'number', id: 'Systolic', label: "Systolic" });
      dataTable2.addColumn({ type: 'number', id: 'Diastolic', label: "Diastolic" });
      
      dataTable.addRows([
        [new Date('08/01/2016'),  80],
        [new Date('08/08/2016'),  90],
        [new Date('08/15/2016'),  100],
        [new Date('08/22/2016'),  91],
        [new Date('08/25/2016'),  20]
      ]);
      
      dataTable2.addRows([
        [new Date('08/01/2016'),  90],
        [new Date('08/06/2016'),  70],
        [new Date('08/15/2016'),  50],
        [new Date('08/18/2016'),  40],
        [new Date('08/22/2016'),  60],
        [new Date('08/25/2016'),  30]
      ]);
            
      bloodPressureDataTable = google.visualization.data.join(dataTable, dataTable2, 'full', [[0, 0]], [1], [1]);
      
      drawChart("blood_pressure", bloodPressureDataTable);
      customizations("blood_pressure");
    }

    function drawChart(element_id, dataTable) {

      console.log("MAX: " + dataTable.getColumnRange(1).max);
      console.log("MIN: " + dataTable.getColumnRange(1).min);
      
      var chartWidth = $("." + element_id).width();
      var options = {	  
        hAxis: {
          gridlines: { color: '#FFFFFF' },
          format: 'M.dd'
        },
        vAxis:{
        // baselineColor: '#000',
         gridlineColor: '#FFF',
      //   viewWindowMode:'explicit',
          viewWindow: {
            min: dataTable.getColumnRange(1).min - 10
          }         
        },
        legend: {
          position: 'none'
//          position: 'top',
//          alignment: 'end'
        },
        width: chartWidth,
        height: chartWidth * 0.3,
        chartArea: { 
          top: 30,
          bottom: 50
        },
        pointsVisible: true,
        colors: ['#5A84A2','#990000'],
        interpolateNulls: true
      };
      
      var container = document.getElementById(element_id);
      var chart = new google.visualization.LineChart(container);

      chart.draw(dataTable, options);
      
      if (element_id == "weight") {

        var graph = d3.select('#weight svg');
        console.log("WIDTH: " + graph.attr("width"))
        
// Draw a line on the chart
       
        var line = graph.append('line')
          .attr('transform', 'translate(100, 50)')
          .attr('x1', 0)
          .attr('x2', 400)
          .attr('y1', 0)
          .attr('y2', 0)
          .attr('class', 'selection_line');


// Fill in a region on a chart (this needs work to figure out position)

        var demo_region = graph.append('rect')
          .attr('transform', 'translate(80, 60)')
          .attr('x', 0)
          .attr('y', 0)
          .attr('width', 457)
          .attr('height', 60)
          .attr('stroke', 'none')
          .attr('fill-opacity', '0.1')
          .attr('fill', '#009900');
                    
//        Add a class to all the hAxis labels
//        $("#" + element_id + " text[text-anchor='middle']").addClass("axis")

        // Rotate the hAxis labels
        var hAxisLabels = d3.selectAll("#" + element_id + " text[text-anchor='middle']")
        hAxisLabels.each(function( index ) {
          x = $(this).attr("x");
          y = $(this).attr("y");
          $(this).attr("transform", "translate(0,5) rotate(-45," + x + "," + y + ")");
        });

      }
      
    }
    
    //create trigger to resizeEnd event     
    $(window).resize(function() {
        if(this.resizeTO) clearTimeout(this.resizeTO);
        this.resizeTO = setTimeout(function() {
            $(this).trigger('resizeEnd');
        }, 500);
    });

    //redraw graph when window resize is completed  
    $(window).on('resizeEnd', function() {
        drawWeightChart();
        drawBloodPressureChart();
    });

    $( document ).ready(function() {
    });
      
    
  </script>
</head>
<body>
  <h2>Weight</h2>
  <div id="weight"></div>
  <h2>Blood Pressure</h2>
  <div id="blood_pressure"></div>
</body>
</html>
